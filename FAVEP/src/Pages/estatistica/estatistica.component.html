<app-menu-central></app-menu-central>
<app-menu-lateral></app-menu-lateral>

<main class="main-content">
  <div class="filtros-container">
    <div class="filtro-group">
      <label for="filtro-propriedade">Filtrar por Propriedade:</label>
      <select id="filtro-propriedade" [(ngModel)]="selectedPropertyId" (change)="processarDadosEstatisticos()">
        <option value="todos">Todas as Propriedades (Ativas)</option>
        <option *ngFor="let prop of propriedades" [value]="prop.id">
          {{ prop.nomepropriedade }} {{ prop.status === 'inativo' ? '(Desativada)' : '' }}
        </option>
      </select>
    </div>
  </div>
  
  <div class="resumo-cards">
    <div class="resumo-card">
      <h3>Propriedades</h3>
      <p class="valor">{{totalPropriedades}}</p>
      <p class="info">Área Total: {{areaTotal | number:'1.0-0':'pt-BR'}} ha</p>
    </div>

    <div class="resumo-card">
      <h3>Produção Total</h3>
      <p class="valor">{{producaoAtual | number:'1.0-0':'pt-BR'}} kg</p>
    </div>

    <div class="resumo-card">
      <h3>Resultado Financeiro</h3>
      <p class="valor" [class.positivo]="resultadoFinanceiro >= 0" [class.negativo]="resultadoFinanceiro < 0">
        {{resultadoFinanceiro | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}
      </p>
    </div>
  </div>
  <div class="graficos-container">
    <div class="grafico-card">
      <h3>Produtividade por Cultura</h3>
      <div *ngIf="hasProdutividadeData; else noProdutividadeData" class="chart-wrapper">
        <canvas #produtividadeChart></canvas>
      </div>
      <ng-template #noProdutividadeData>
        <div class="no-data-message">
          <i class="fas fa-chart-bar"></i>
          <p>Não há dados de produção para exibir.</p>
        </div>
      </ng-template>
    </div>
    <div class="grafico-card">
      <h3>Receitas x Despesas</h3>
      <div *ngIf="hasFinanceiroData; else noFinanceiroData" class="chart-wrapper">
        <canvas #financeiroChart></canvas>
      </div>
      <ng-template #noFinanceiroData>
        <div class="no-data-message">
          <i class="fas fa-dollar-sign"></i>
          <p>Não há dados financeiros para exibir.</p>
        </div>
      </ng-template>
    </div>
  </div>
</main>