<div class="dashboard-container">
  <header class="dashboard-header">
    <button class="menu-toggle" aria-label="Abrir menu" (click)="alternarMenu()">
      <i class="fas fa-bars"></i>
    </button>
    <h1>
      <img src="assets/img/FAVEP_LOGO_nobg.png" alt="Logo FAVEP" class="header-logo-img"> FAVEP - Gestão Agrícola
    </h1>
    <div class="user-info" (click)="mostrarDropdown = !mostrarDropdown">
      <span>Olá, {{ usuarioNome }}</span>
      <img [src]="usuarioFoto" [alt]="'Foto de ' + usuarioNome" class="user-avatar">
      <div class="dropdown-menu" *ngIf="mostrarDropdown">
        <a (click)="abrirModalPerfil()">Perfil</a>
        
        <a (click)="logout()" class="logout-link">Sair</a>
      </div>
    </div>
  </header>
  <nav class="main-menu" [class.open]="menuAberto">
    <a routerLink="/home" routerLinkActive="active">
      <span class="material-symbols-outlined">home</span> Home
    </a>
    <a routerLink="/gerenciamento" routerLinkActive="active">
      <span class="material-symbols-outlined">dashboard</span> Gerenciamento
    </a>
    <a routerLink="/estatistica" routerLinkActive="active">
      <span class="material-symbols-outlined">monitoring</span> Estatística
    </a>
    <a routerLink="/relatorio" routerLinkActive="active">
      <span class="material-symbols-outlined">overview</span> Relatório geral
    </a>
    <a routerLink="/usuario" routerLinkActive="active">
      <span class="material-symbols-outlined">account_circle</span> Configuração
    </a>
  </nav>

  <main class="dashboard-content">
    <div class="filtros-container">
      <div class="filtro-group">
        <label for="filtro-propriedade">Filtrar por Propriedade:</label>
        <select id="filtro-propriedade" [(ngModel)]="selectedPropertyId" (change)="processarDadosEstatisticos()">
          <option *ngFor="let prop of propriedades" [value]="prop.id">{{ prop.nomepropriedade }}</option>
          <option value="todos">Todas as Propriedades</option>
        </select>
      </div>
    </div>
    
    <div class="resumo-cards">
      <div class="resumo-card">
        <h3>Propriedades</h3>
        <p class="valor">{{totalPropriedades}}</p>
        <p class="info">Área Total: {{areaTotal | number:'1.0-0':'pt-BR'}} ha</p>
      </div>

      <div class="resumo-card">
        <h3>Produção Total</h3>
        <p class="valor">{{producaoAtual | number:'1.0-0':'pt-BR'}} kg</p>
        </div>

      <div class="resumo-card">
        <h3>Resultado Financeiro</h3>
        <p class="valor" [class.positivo]="resultadoFinanceiro >= 0" [class.negativo]="resultadoFinanceiro < 0">
          {{resultadoFinanceiro | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}
        </p>
      </div>
    </div>
    <div class="graficos-container">
      <div class="grafico-card">
        <h3>Produtividade por Cultura</h3>
        <canvas #produtividadeChart></canvas>
      </div>
      <div class="grafico-card">
        <h3>Receitas x Despesas</h3>
        <canvas #financeiroChart></canvas>
      </div>
    </div>
  </main>
</div>
