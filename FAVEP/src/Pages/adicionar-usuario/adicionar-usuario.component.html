<div class="dashboard-container">
    <header class="dashboard-header">
        <button class="menu-toggle" aria-label="Abrir menu" (click)="alternarMenu()">
            <i class="fas fa-bars"></i>
        </button>
        <h1>
            <img src="assets/img/FAVEP_LOGO_nobg.png" alt="Logo FAVEP" class="header-logo-img"> FAVEP - Gestão Agrícola
        </h1>
        <div class="user-info" (click)="mostrarDropdown = !mostrarDropdown">
            <span>Olá, {{ usuarioNome }}</span>
            <img [src]="usuarioFoto" [alt]="'Foto de ' + usuarioNome" class="user-avatar">
            <div class="dropdown-menu" *ngIf="mostrarDropdown">
                <a (click)="abrirModalPerfil($event)">Perfil</a>
                <a (click)="logout($event)" class="logout-link">Sair</a>
            </div>
        </div>
    </header>

    <nav class="main-menu" [class.open]="menuAberto">
        <a routerLink="/home" routerLinkActive="active">
            <span class="material-symbols-outlined">home</span> Home
        </a>
        <a routerLink="/gerenciamento" routerLinkActive="active">
            <span class="material-symbols-outlined">dashboard</span> Gerenciamento
        </a>
        <a routerLink="/estatistica" routerLinkActive="active">
            <span class="material-symbols-outlined">monitoring</span> Estatística
        </a>
        <a routerLink="/relatorio" routerLinkActive="active">
            <span class="material-symbols-outlined">overview</span> Relatório geral
        </a>
        <div class="menu-item-dropdown" [class.open]="submenuAberto">
            <a (click)="toggleSubmenu()" [class.active]="isConfigActive()">
                <span class="material-symbols-outlined">account_circle</span>
                Configuração
                <span class="material-symbols-outlined dropdown-icon">expand_more</span>
            </a>
            <ul class="submenu">
                <li>
                    <a routerLink="/usuario" routerLinkActive="active">
                        <span class="material-symbols-outlined">account_circle</span>
                        Perfil
                    </a>
                </li>
                <li>
                    <a routerLink="/plano-assinatura" routerLinkActive="active">
                        <span class="material-symbols-outlined">credit_card</span>
                        Trocar Plano
                    </a>
                </li>
                <li>
                    <a routerLink="/adicionar-usuario" routerLinkActive="active">
                        <span class="material-symbols-outlined">person_add</span>
                        Adicionar Perfil
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="card-adduser">
        <h4><i class="fas fa-user-plus"></i> Adicionar Novo Usuário</h4>

        <form #userForm="ngForm" (ngSubmit)="addUser(userForm)">
            <div class="form-row">
                <div class="form-group">
                    <label for="newUserEmail">E-mail do Usuário</label>
                    <input type="email" id="newUserEmail" name="email" [(ngModel)]="newUser.email" placeholder="exemplo@dominio.com" required email #emailInput="ngModel">
                    <div *ngIf="emailInput.invalid && (emailInput.dirty || emailInput.touched)" class="validation-message">
                        <div *ngIf="emailInput.errors?.['required']">
                            E-mail é obrigatório.
                        </div>
                        <div *ngIf="emailInput.errors?.['email']">
                            Por favor, insira um e-mail válido.
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newUserPassword">Senha Provisória</label>
                    <input type="password" id="newUserPassword" name="password" [(ngModel)]="newUser.password" placeholder="Crie uma senha forte" required minlength="8" #passwordInput="ngModel">
                    <div *ngIf="passwordInput.invalid && (passwordInput.dirty || passwordInput.touched)" class="validation-message">
                        <div *ngIf="passwordInput.errors?.['required']">
                            A senha é obrigatória.
                        </div>
                        <div *ngIf="passwordInput.errors?.['minlength']">
                            A senha deve ter pelo menos 8 caracteres.
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="accessLevel">Nível de Acesso</label>
                    <select id="accessLevel" name="accessLevel" [(ngModel)]="newUser.accessLevel" required #levelSelect="ngModel">
                        <option value="" disabled selected>Selecione um nível</option>
                        <option value="admin">Administrador (Acesso total, exceto adicionar usuários)</option>
                        <option value="funcionario">Funcionário (Visualização e gerar relatórios)</option>
                    </select>
                    <div *ngIf="levelSelect.invalid && (levelSelect.dirty || levelSelect.touched)" class="validation-message">
                        Nível de acesso é obrigatório.
                    </div>
                </div>

                <div class="form-group-button">
                    <button type="submit" class="add-user-btn" [disabled]="!userForm.form.valid">
                        <i class="fas fa-check"></i> Criar Usuário
                    </button>
                </div>
            </div>
            
            <div *ngIf="statusMessage" [class.success]="statusMessage.includes('sucesso')" [class.error]="statusMessage.includes('erro')" class="status-message">
                {{ statusMessage }}
            </div>
        </form>
    </div>
</div>