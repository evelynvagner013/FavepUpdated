generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Cargo {
  ADMINISTRADOR
  GERENTE
  FUNCIONARIO
}

model usuario {
  id                       String              @id @default(uuid())
  nome                     String
  email                    String              @unique
  telefone                 String
  fotoperfil               String?
  senha                    String
  emailVerified            Boolean?            @default(false)
  verificationToken        String?
  resetPasswordToken       String?             @unique
  resetPasswordExpires     DateTime?
  verificationTokenExpires DateTime?           @map("verification_token_expires_at")
  authCode                 String?             @map("auth_code")
  authCodeExpires          DateTime?           @map("auth_code_expires_at")
  cargo                    Cargo               @default(ADMINISTRADOR)
  profileCompleted         Boolean             @default(false)
  adminId                  String?
  planos                   PlanosMercadoPago[]
  propriedades             propriedade[]
 
  propriedadesAcessiveis   propriedade[]     @relation("PermissaoAcesso")
  admin                    usuario?          @relation("AdminSubUsuarios", fields: [adminId], references: [id])
  subUsuarios              usuario[]         @relation("AdminSubUsuarios")
}

model propriedade {
  id              String       @id @default(uuid())
  nomepropriedade String
  localizacao     String?
  usuarioId       String
  area_ha         Int?         @map("area_ha")
  status          String
  financeiros     financeiro[]
  producoes       producao[]
  
  usuario         usuario      @relation(fields: [usuarioId], references: [id])
  usuariosComAcesso usuario[]  @relation("PermissaoAcesso")

  @@map("propriedade")
}

model producao {
  id            Int         @id @default(autoincrement())
  safra         String
  areaproducao  Float
  data          DateTime
  cultura       String
  quantidade    Float
  status        String      @default("ativo")
  propriedadeId String
  propriedade   propriedade @relation(fields: [propriedadeId], references: [id])

  @@map("producao")
}

model financeiro {
  id            Int         @id @default(autoincrement())
  descricao     String
  valor         Float
  data          DateTime
  tipo          String
  propriedadeId String
  propriedade   propriedade @relation(fields: [propriedadeId], references: [id])

  @@map("financeiro")
}

model PlanosMercadoPago {
  id                  String    @id @default(uuid())
  status              String
  tipo                String
  valor               Float
  dataAssinatura      DateTime  @default(now())
  metodoPagamento     String
  usuarioId           String
  idAssinaturaExterna String?   @unique
  idPagamentoExterno  String?   @unique @map("id_pagamento_externo")
  dataAtivacao        DateTime?
  dataExpiracao       DateTime?
  usuario             usuario   @relation(fields: [usuarioId], references: [id])

  @@map("planos_mercado_pago")
}